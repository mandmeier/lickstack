{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}



{% block head_title %}{{ block.super }} | {{article.title }}{% endblock head_title %}


{% block content %}

<link rel="stylesheet" type="text/css" href="{% static 'css/blog.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/lick_snippet.css' %}">

<style type="text/css">
.chords-row {
    background-image: url("{% static 'img/staff.webp' %}"),url("{% static 'img/staff.png' %}");
}
</style>

<script type="text/javascript">
    // used to select initial value of transpose button
    function selectElement(id, valueToSelect) {
    let element = document.getElementById(id);
    element.value = valueToSelect;
    }
</script>


<section>
        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}">
           Facebook
        </a>

        <a href="https://twitter.com/home?status={{ share_string }}%20{{ request.build_absolute_uri }}">
           Twitter
        </a>

        <a href="http://www.reddit.com/submit?url={{ request.build_absolute_uri }}&title={{ share_string }}">
           Reddit
        </a>

        <h1>{{ article.title }}</h1>
        <p><small>{{ article.author }} | {% if article.draft %}<span style="color:red;">Draft</span>{% endif %} {{ article.date_published }}</small></p>
        <p><b>{{ article.description }}</b></p>

        {% if article.image %}
        <img src='{{article.image.url}}' class='img-responsive'>
        {% endif %}
        <hr>
        <div>{{ article.get_markdown }}</div>

</section>

    {% for lick in licks %}
        {% include 'repo/snippets/lick_snippet.html' with lick=lick chord_seq_query=chord_seq_query %}
    {% endfor %}


<section id="comments_section">
    <p class='lead' >Comments</p>
    {% if request.user.is_authenticated %}
    <form method="POST" accept=".">
        {% csrf_token %}
        {{ comment_form|crispy }}
        <input type="submit" value="Post comment" class="btn btn-secondary">
    </form>
    {% else %}
    <p><a href="{% url 'login' %}?next={{ article.get_absolute_url }}#comments_section">Log in</a> to comment.</p>
    {% endif %}
    <hr>
    {% for comment in comments %}
        <blockquote>
        <div class="comment-content">
            <small>{{ comment.author }} | {{ comment.timestamp|timesince }} ago | {% if comment.children.count > 0 %}{{ comment.children.count}} Comment{{ comment.children.count|pluralize }} | {% endif %}</small>
            <a class="comment-reply-btn" href="#">Reply</a> | <a href="{{ comment.get_absolute_url }}">Thread</a><br>
            {{ comment.content }}
            <hr>
        </div>
        <div class="comment-reply">
            {% for child_comment in comment.children %}
            <blockquote>
                <small>{{ child_comment.author }} - {{ child_comment.timestamp|timesince }} ago: </small><br>
                {{ child_comment.content }}
            </blockquote>
            {% endfor %}
            {% if request.user.is_authenticated %}
            <form method="POST" accept=".">
                {% csrf_token %}
                {{ comment_form|crispy }}
                <input type="hidden" name="parent_id" value="{{ comment.id }}">
                <input type="submit" value="reply" class="btn btn-secondary">
            </form>
            {% else %}
            <p><a href="{% url 'login' %}?next={{ article.get_absolute_url }}">Log in</a> to comment.</p>
            {% endif %}
        </div>
        </blockquote>
    {% endfor %}
</section>


<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.5.35/Tone.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

<script type="text/javascript">

    // used to select initial value of transpose button
    function selectElement(id, valueToSelect) {
    let element = document.getElementById(id);
    element.value = valueToSelect;
    }

    const chords_dir = "{% static 'img/chords/' %}";
    const tortoise_on_url = "{% static 'img/tortoise_hover.webp' %}";
    const tortoise_off_url = "{% static 'img/tortoise_toggled.webp' %}";

    $(document).on('click', '.comment-reply-btn', function() {
        event.preventDefault();
        $(this).parent().next(".comment-reply").fadeToggle();
    });

</script>


<script type="text/javascript">
    // initial transpose licks
    var initial_transpose = "{{ transpose_string }}".split(',')
</script>
<script src="{% static 'js/lick_snippet.js' %}"></script>


{% endblock content %}
