{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}

<style>
    .lick-form {
        margin-top: 50px;
        margin-bottom: 100px;
        background: #f9f9f9;
        width: 100%;
        padding: 5px;
        border: 2px solid #234444;
        border-radius: 15px;
    }
    .chords-row, .form-input {
        margin-top: 20px;
        margin-bottom: 20px;
    }
    #chords {
        /*background-color: #ff0000;*/
        margin: 0px 1px 0px 1px;
        font-size: 0;
        padding: 0px;
        height: 40px;
        max-width: calc(85% / 8);
    }
    .file-preview {
        width: 100%;
        height: 50px;
        border: 2px solid #ddd;
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .file-preview__file {
        display: none;
        margin: 8px 0;
        width: 100%;
    }
    .file-preview__default-text {
        display: flex;
        justify-content: center;
        font-weight: bold;
        color: #888888;
    }
    .file-input, .file-preview, .chords-input {
        /*background-color: #00ff00;
        width: 100%;*/
    }
    .form-submit {
        margin-bottom: 10px
    }


</style>

<div class="container-fluid col-12">
    <form class="lick-form" method="POST" enctype="multipart/form-data">
        <h2>Upload Lick</h2>
        {% csrf_token %}
        <div class="file-input">
            {{ form.file|as_crispy_field }}
        </div>

        <div class="file-preview" id="filePreview">
            <audio class="file-preview__file" controls preload="none">
                <source src="" type="audio/mp4" >
                Your browser does not support HTML5 audio. Try Chrome 6+
            </audio>
            <br>
            <span class="file-preview__default-text"> File Preview </span>
        </div>

        <div class="chords-input col-12">
        <div class="row chords-row">
            <img class="bar" src="{% static 'img/chords/bar.png' %}">
                <div id="chords">{{ form.beat1|as_crispy_field }} </div>
                <div id="chords">{{ form.beat2|as_crispy_field }} </div>
                <div id="chords">{{ form.beat3|as_crispy_field }} </div>
                <div id="chords">{{ form.beat4|as_crispy_field }} </div>
            <img class="bar" src="{% static 'img/chords/bar.png' %}">
                <div id="chords">{{ form.beat5|as_crispy_field }} </div>
                <div id="chords">{{ form.beat6|as_crispy_field }} </div>
                <div id="chords">{{ form.beat7|as_crispy_field }} </div>
                <div id="chords">{{ form.beat8|as_crispy_field }} </div>
            <img class="bar" src="{% static 'img/chords/bar.png' %}">
        </div>
        <div class="row">
            <img class="bar" src="{% static 'img/chords/bar.png' %}">
                <div id="chords">{{ form.beat9|as_crispy_field }} </div>
                <div id="chords">{{ form.beat10|as_crispy_field }} </div>
                <div id="chords">{{ form.beat11|as_crispy_field }} </div>
                <div id="chords">{{ form.beat12|as_crispy_field }} </div>
            <img class="bar" src="{% static 'img/chords/bar.png' %}">
                <div id="chords">{{ form.beat13|as_crispy_field }} </div>
                <div id="chords">{{ form.beat14|as_crispy_field }} </div>
                <div id="chords">{{ form.beat15|as_crispy_field }} </div>
                <div id="chords">{{ form.beat16|as_crispy_field }} </div>
            <img class="bar" src="{% static 'img/chords/bar.png' %}">
        </div>
        </div>

        <div class="form-input row">
            <div class="col-lg-6">
                {{ form.genre|as_crispy_field }}
            </div>
            <div class="col-lg-6">
                {{ form.instrument|as_crispy_field }}
            </div>
        </div>

        <div class="form-submit">
            <button class="btn btn-primary btn-block btn-lg" type="submit">Submit</button>
        </div>
    </form>
</div>



<!-- preview script -->
<script type="text/javascript">
    /* https://www.youtube.com/watch?v=VElnT8EoEEM */
    const inpFile = document.getElementById("inpFile");
    const previewContainer = document.getElementById("filePreview");
    const previewAudio = previewContainer.querySelector(".file-preview__file");
    const previewDefaultText = previewContainer.querySelector(".file-preview__default-text");

    inpFile.addEventListener("change", function() {
        const file = this.files[0];

        if (file) {
            const reader = new FileReader();

            /* hide preview default text */
            previewDefaultText.style.display = "none";
            previewAudio.style.display = "block";

            reader.addEventListener("load", function() {
                previewAudio.setAttribute("src", this.result);
            });

            reader.readAsDataURL(file);
        } else {
            previewDefaultText.style.display = null;
            previewAudio.style.display = null;
            previewImage.setAttribute("src", "");
        }
    });
</script>



{% endblock content %}


